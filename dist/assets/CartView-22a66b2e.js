import{d as E,g as k,B as x,E as m,e as B,n as D,o as l,c as u,q as V,a as F,F as L,k as N,b as d,t as p,r as O,i as W}from"./index-598e1e45.js";import{g as P,b as T,c as $,d as A,e as M}from"./orders-f0a9bf85.js";import{a as U}from"./counter-2828ea18.js";import"./http-dc5150a7.js";import"./products-ddcd2c49.js";const Y={class:"cart"},Q={key:0},j={class:"product-details"},z=["onClick"],G={key:2,class:"cart-summary"},H={key:3,class:"empty-cart-message"},J=d("p",null,"Your cart is currently empty.",-1),K=[J],ae=E({__name:"CartView",setup(R){const c=k(!0),g=k([]),I="http://127.0.0.1/",{refreshCartItems:S}=U(),b=localStorage.getItem("usyd-customer-id");x(async()=>{_()});const w=()=>{c.value=!0;const i=localStorage.getItem("usyd-customer-id"),n=v();T({user_id:i,total_amount:n}).then(a=>{if(a.success){const e=a.data.order_id,o=[];for(const s of g.value){const r={order:e,product:s.product.product_id,quantity:s.quantity,sub_total:s.product.price*s.quantity};o.push($(r))}Promise.all(o).then(s=>{for(const r of s)r.success||console.error("Error adding order item:",r.message)}).catch(s=>{console.error("Error adding order items:",s)}).finally(()=>{A({user_id:i}).then(r=>{r.success&&(m({title:"Success",message:r.data.message,type:"success"}),O.push({name:"paymentdetail",params:{orderId:e}}))}).catch(r=>{var y,f,h,C;m({title:"Warning",message:((f=(y=r.response)==null?void 0:y.data)==null?void 0:f.detail)||((C=(h=r.response)==null?void 0:h.data)==null?void 0:C.message)||r.message,type:"warning"})}).finally(()=>{c.value=!1})})}}).catch(a=>{var e,o,s,r;console.error("Error creating order:",a),m({title:"Warning",message:((o=(e=a.response)==null?void 0:e.data)==null?void 0:o.detail)||((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||a.message,type:"warning"}),c.value=!1})},_=()=>{c.value=!0;var n={user_id:localStorage.getItem("usyd-customer-id")};P(n).then(t=>{t.success&&(g.value=t.data)}).catch(t=>{var a,e,o,s;m({title:"Warning",message:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.detail)||((s=(o=t.response)==null?void 0:o.data)==null?void 0:s.message)||t.message,type:"warning"})}).finally(()=>{c.value=!1})},v=()=>g.value.reduce((i,n)=>i+n.product.price*n.quantity,0).toFixed(2),q=i=>{c.value=!0;var n={id:i};M(n).then(t=>{t.success&&(m({title:"Success",message:t.data.message,type:"success"}),_())}).catch(t=>{var a,e,o,s;m({title:"Warning",message:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.detail)||((s=(o=t.response)==null?void 0:o.data)==null?void 0:s.message)||t.message,type:"warning"})}).finally(()=>{var t={user_id:b};S(t),c.value=!1})};return(i,n)=>{const t=B("el-image"),a=D("loading");return l(),u("div",Y,[V((l(),u("h2",null,[F("Your Shopping Cart")])),[[a,c.value,void 0,{fullscreen:!0,lock:!0}]]),c.value?(l(),u("div",Q,"Loading ...")):(l(!0),u(L,{key:1},N(g.value,e=>(l(),u("div",{key:e.cart_item_id,class:"cart-item"},[W(t,{src:I+e.product.images[0].image,alt:e.product.product_name,class:"product-image",fit:"contain"},null,8,["src","alt"]),d("div",j,[d("h3",null,p(e.product.product_name),1),d("p",null,"Price: $"+p(e.product.price),1),d("p",null,"Quantity: "+p(e.quantity),1),d("button",{class:"remove-button",onClick:o=>q(e.cart_item_id)},"Remove",8,z)])]))),128)),g.value.length>0?(l(),u("div",G,[d("p",null,"Total: $"+p(v()),1),d("button",{class:"checkout-button",onClick:w},"Make an Order")])):(l(),u("div",H,K))])}}});export{ae as default};
