import{d as ee,g as w,G as $,B as ae,e as p,n as se,o as h,c as x,i as s,w as l,q as z,f as O,b as a,a as g,t as m,F as M,k as T,D as G,E as f,p as te,m as le,r as oe,_ as ne}from"./index-48e4bbc4.js";import{g as de,b as ie,d as re,h as ue,i as ce}from"./users-c3030ca3.js";import{f as me}from"./orders-096d3308.js";import"./http-0a3fdf92.js";const k=U=>(te("data-v-28eb4f97"),U=U(),le(),U),_e={class:"app-container",style:{"overflow-x":"hidden"}},pe={key:0},fe=k(()=>a("div",{slot:"header",class:"clearfix"},[a("b",null,[a("span",null,"My Profile")])],-1)),ge={class:"user-profile"},ve={class:"box-center"},we=k(()=>a("br",null,null,-1)),he={class:"user-bio"},be={class:"user-education user-bio-section"},ye={class:"user-bio-section-header"},Ve=k(()=>a("span",null,"Contact",-1)),Pe={class:"user-bio-section-body"},Ce={class:"text-muted"},xe=k(()=>a("br",null,null,-1)),ke=k(()=>a("br",null,null,-1)),Ue={class:"order-card"},De={class:"order-details"},Se={class:"order-number"},Ie={class:"order-date"},Ne={class:"order-total"},Oe={class:"order-status"},We={class:"order-items"},qe={class:"item-name"},Ee={class:"item-price"},Ae={class:"edit-profile"},j=2,Be=ee({__name:"UserProfileView",setup(U){const b=w(!1),D=w(!1),S=w(!1);localStorage.getItem("usyd-customer-token");const I=localStorage.getItem("usyd-customer-email"),H=localStorage.getItem("usyd-customer-id"),W=w("myorders"),C=w(1),q=w(0),E=w([]),n=$({email:I,first_name:"",address:"",phone_number:""}),i=$({email:I,password:"",newpassword:"",cnewpassword:""}),d=w({id:"",name:"loading...",email:"loading...",address:"loading...",phone_number:"loading...",is_staff:!1,is_active:!0}),J=u=>{const e=new Date(u),o={day:"2-digit",month:"short",year:"numeric"};return e.toLocaleDateString("en-US",o)},K=u=>{oe.push({name:"paymentdetail",params:{orderId:u}})},Q=async u=>{C.value=u,A()},A=()=>{const e={user_id:localStorage.getItem("usyd-customer-id"),page_num:C.value,page_size:j};console.log(C.value),b.value=!0,me(e).then(o=>{o.code!=200?f({title:"Warning",message:o.data.message,type:"warning"}):(E.value=o.data,q.value=o.page.total)}).catch(o=>{var r,_,c,y;f({title:"Warning",message:((_=(r=o.response)==null?void 0:r.data)==null?void 0:_.detail)||((y=(c=o.response)==null?void 0:c.data)==null?void 0:y.message)||o.message,type:"warning"})}).finally(()=>{b.value=!1})};ae(async()=>{B(),A()});const B=()=>{b.value=!0;var u={id:H,email:I};de(u).then(e=>{e.success&&(n.first_name=e.data[0].first_name,d.value.name=e.data[0].first_name,d.value.email=e.data[0].email,d.value.id=e.data[0].id,d.value.is_staff=e.data[0].is_staff,d.value.is_active=e.data[0].is_active)}).catch(()=>{}).finally(()=>{b.value=!1}),ie(u).then(e=>{e.success&&(n.address=e.data.address,n.phone_number=e.data.phone_number,d.value.address=e.data.address,d.value.phone_number=e.data.phone_number)}).catch(()=>{}).finally(()=>{b.value=!1})},R=()=>{if(!n.email||!n.first_name||!n.address||!n.phone_number){f({title:"Warning",message:"Please fill in all fields.",type:"warning"});return}S.value=!0;const u={id:d.value.id,email:d.value.email,is_staff:d.value.is_staff,first_name:n.first_name,is_active:d.value.is_active},e={user:d.value.id,full_name:n.first_name,address:n.address,phone_number:n.phone_number};Promise.all([re(u),ue(e)]).then(([o,r])=>{o.code===200&&r.code===200?(f({title:"Success",message:"Profile and contact details updated successfully.",type:"success"}),B()):f({title:"Warning",message:o.data.message||r.data.message||"An error occurred",type:"warning"})}).catch(o=>{var r,_,c,y;console.log("warning"),f({title:"Warning",message:((_=(r=o.response)==null?void 0:r.data)==null?void 0:_.detail)||((y=(c=o.response)==null?void 0:c.data)==null?void 0:y.message)||o.message||"An error occurred",type:"warning"})}).finally(()=>{S.value=!1})},X=()=>{if(!i.email||!i.password||!i.cnewpassword||!i.newpassword){f({title:"Warning",message:"Please fill in all fields.",type:"warning"});return}if(i.newpassword!==i.cnewpassword){f({title:"Warning",message:"Passwords do not match.",type:"warning"});return}D.value=!0;const u={email:i.email,password:i.password,newpassword:i.newpassword};ce(u).then(e=>{e.code!=200?f({title:"Warning",message:e.data.message,type:"warning"}):f({title:"Success",message:e.data.message,type:"success"})}).catch(e=>{var o,r,_,c;console.log("warning"),f({title:"Warning",message:((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.detail)||((c=(_=e.response)==null?void 0:_.data)==null?void 0:c.message)||e.message,type:"warning"})}).finally(()=>{D.value=!1})};return(u,e)=>{const o=p("svg-icon"),r=p("el-card"),_=p("el-col"),c=p("el-button"),y=p("el-pagination"),N=p("el-tab-pane"),V=p("el-input"),v=p("el-form-item"),F=p("el-form"),Y=p("el-tabs"),Z=p("el-row"),L=se("loading");return h(),x("div",_e,[d.value?(h(),x("div",pe,[s(Z,{gutter:20},{default:l(()=>[s(_,{span:6,xs:24},{default:l(()=>[z((h(),O(r,{style:{"margin-bottom":"20px"}},{default:l(()=>[fe,a("div",ge,[a("div",ve,[g(" Welcome, "),we,a("b",null,m(d.value.name),1)])]),a("div",he,[a("div",be,[a("div",ye,[s(o,{"icon-class":"education"}),Ve]),a("div",Pe,[a("div",Ce,[g(" Email : "),a("b",null,m(d.value.email),1),xe,g(" Phone Number : "),a("b",null,m(d.value.phone_number),1),ke,g(" Address : "),a("b",null,m(d.value.address),1)])])])])]),_:1})),[[L,b.value,void 0,{fullscreen:!0,lock:!0}]])]),_:1}),s(_,{span:18,xs:24},{default:l(()=>[s(r,null,{default:l(()=>[s(Y,{modelValue:W.value,"onUpdate:modelValue":e[7]||(e[7]=t=>W.value=t)},{default:l(()=>[s(N,{label:"My Orders",name:"myorders"},{default:l(()=>[a("div",Ue,[(h(!0),x(M,null,T(E.value,t=>(h(),O(r,{key:t.order_id},{default:l(()=>[a("div",De,[a("div",Se,"Order #"+m(parseInt(t.order_id,16)),1),a("div",Ie," Order Date: "+m(J(t.order_date)),1),a("div",Ne,"Total Amount: $"+m(t.total_amount),1),a("div",Oe,[g(" Payment Status: "),a("b",null,m(t.status),1),t.status==="pending"?(h(),O(c,{key:0,style:{"margin-left":"10px"},type:"primary",onClick:P=>K(t.order_id)},{default:l(()=>[g(" Pay Now ")]),_:2},1032,["onClick"])):G("",!0)]),a("div",We,[(h(!0),x(M,null,T(t.order_items,P=>(h(),x("div",{class:"order-item",key:P.order_item_id},[a("div",qe,[g(m(P.product.product_name)+" @ ",1),a("b",null,"$"+m(P.product.price),1),g(" x "+m(P.quantity),1)]),a("div",Ee,"$ "+m(P.sub_total.toFixed(2)),1)]))),128))])])]),_:2},1024))),128))]),z(s(y,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),"page-size":j,total:q.value,layout:"prev, pager, next",onCurrentChange:Q},null,8,["modelValue","total"]),[[L,b.value,void 0,{fullscreen:!0,lock:!0}]])]),_:1}),s(N,{label:"Edit Contact",name:"editcontact"},{default:l(()=>[a("div",Ae,[s(F,{"label-position":"left","label-width":"110px",model:n},{default:l(()=>[s(v,{label:"Name"},{default:l(()=>[s(V,{modelValue:n.first_name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.first_name=t)},null,8,["modelValue"])]),_:1}),s(v,{label:"Address"},{default:l(()=>[s(V,{modelValue:n.address,"onUpdate:modelValue":e[2]||(e[2]=t=>n.address=t)},null,8,["modelValue"])]),_:1}),s(v,{label:"Phone Number"},{default:l(()=>[s(V,{modelValue:n.phone_number,"onUpdate:modelValue":e[3]||(e[3]=t=>n.phone_number=t)},null,8,["modelValue"])]),_:1}),s(v,null,{default:l(()=>[s(c,{loading:S.value,type:"primary",onClick:R},{default:l(()=>[g("Update")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1}),s(N,{label:"Change Password",name:"changepassword"},{default:l(()=>[a("div",null,[s(F,{"label-position":"left",model:i,"label-width":"170px"},{default:l(()=>[s(v,{label:"Old Password"},{default:l(()=>[s(V,{placeholder:"Please input old password","show-password":"",modelValue:i.password,"onUpdate:modelValue":e[4]||(e[4]=t=>i.password=t)},null,8,["modelValue"])]),_:1}),s(v,{label:"New Password"},{default:l(()=>[s(V,{type:"password",autocomplete:"off",placeholder:"Please input password","show-password":"",modelValue:i.newpassword,"onUpdate:modelValue":e[5]||(e[5]=t=>i.newpassword=t)},null,8,["modelValue"])]),_:1}),s(v,{label:"Confirm New Password"},{default:l(()=>[s(V,{type:"password",placeholder:"Please input confirm password","show-password":"",autocomplete:"off",modelValue:i.cnewpassword,"onUpdate:modelValue":e[6]||(e[6]=t=>i.cnewpassword=t)},null,8,["modelValue"])]),_:1}),s(v,null,{default:l(()=>[s(c,{loading:D.value,type:"primary",onClick:X},{default:l(()=>[g("Change Password")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])):G("",!0)])}}});const Me=ne(Be,[["__scopeId","data-v-28eb4f97"]]);export{Me as default};
