import{I as $,S as A,T as G}from"./TablePage-ca487319.js";import{d as J,J as Y,G as v,g as d,e as s,o as m,c as b,b as P,i as l,w as i,u as N,a as _,F as q,k as S,E as c,K as D,f as j,_ as H}from"./index-1c796aa9.js";import{g as Q}from"./categories-fa11bf5a.js";import{c as X,d as Z,g as ee}from"./products-966e8412.js";import"./http-8cec2738.js";const te={class:"div-search-bar"},ae={class:"table-div"},le=["src"],re=J({__name:"ProductView",setup(oe){Y();const V=v([{name:"Name",value:""},{name:"Is Custumized",value:null,type:$.Select,single:!0,options:[{id:!0,name:"YES"},{id:!1,name:"NO"}]}]),C=d(!0),z=d([]),I=v([{dataKey:"product_name",key:"product_name",title:"Name",width:450},{key:"images",title:"Images",width:120,cellRenderer:t=>l("div",null,[t.rowData.images.map((e,r)=>l("img",{width:30,src:"http://54.209.226.127:8000/"+e.image},null))])},{dataKey:"quantity",key:"quantity",title:"Stock",width:80},{dataKey:"price",key:"price",title:"Price",width:80},{dataKey:"original_price",key:"original_price",title:"Original Price",width:120},{dataKey:"last_updated_date",key:"last_updated_date",title:"Update at",width:250},{dataKey:"last_created_date",key:"last_created_date",title:"Create at",width:250},{key:"option",title:"Options",cellRenderer:t=>l("div",null,[l(s("el-popconfirm"),{"hide-after":0,width:"170",title:`Delete ${t.rowData.product_name}?`,onConfirm:()=>L(t)},{reference:()=>l(s("el-button"),{link:!0,type:"danger"},{default:()=>[_("Delete")]})})]),width:150,fixed:"right",align:"center"}]),g=d(!1),a=v({category_id:"",product_name:"",quantity:0,price:0,original_price:0,images:[]}),f=d([]),B=()=>{g.value=!0,f.value=[],a.product_name="",a.images=[],a.category_id=k.value[0].category_id},T=()=>{if(!a.product_name.trim()){c({title:"Warning",message:"Please input product name.",type:"warning"});return}if(a.images.length==0){c({title:"Warning",message:"Please select at least one image.",type:"warning"});return}var t=new FormData;t.append("product_name",a.product_name),t.append("category",a.category_id),t.append("quantity",a.quantity),t.append("price",a.price),t.append("original_price",a.original_price),a.images.forEach(e=>{t.append("images",e)}),X(t).then(e=>{if(console.log(e),e.success)c({title:"Success",message:"Upload successfully.",type:"success"});else throw"error"}).catch(()=>{c({title:"Warning",message:"Something wrong.",type:"warning"})}).finally(()=>{g.value=!1,p()})},U=()=>{console.log("open");var t=document.createElement("input");t.type="file",t.multiple=!0,t.accept="image/*",t.addEventListener("change",e=>{console.log("file",e.target.files[0]);for(let r=0;r<e.target.files.length;r++)if(console.log(e.target.files[r].size),e.target.files[r].size>2048e3){c({title:"Warning",message:"The image is too large. ",type:"warning"});return}if(a.images.length+e.target.files.length>9){c({title:"Warning",message:"Maximum 9 images.",type:"warning"});return}for(let r=0;r<e.target.files.length;r++)a.images.find(n=>n.name==e.target.files[r].name&&n.size==e.target.files[r].size)||a.images.push(e.target.files[r]);f.value=[],console.log("images",a.images),a.images.forEach((r,n)=>{const w=new FileReader;w.readAsDataURL(r),w.onload=u=>{f.value[n]=u.currentTarget.result,console.log(n,"done")}})}),t.click()};d(!1),d("888");const L=t=>{console.log("Delete -> ",t.rowData);var e={id:t.rowData.product_id};Z(e).then(r=>{console.log("success",r)}).catch(()=>{}).finally(()=>{p()})},y=v({currentPage:1,pageSize:20}),K=t=>{y.currentPage=t.currentPage,y.pageSize=t.pageSize,p()},E=d(),k=d({}),p=()=>{var e,r;C.value=!0;var t={page_num:y.currentPage,page_size:y.pageSize,product_name:(e=V.find(n=>n.name=="Name"))==null?void 0:e.value,is_customized:(r=V.find(n=>n.name=="Is Custumized"))==null?void 0:r.value};Promise.all([ee(t),Q({})]).then(n=>{if(console.log("all done",n),n[0].success)z.value=n[0].data,E.value=n[0].page.total;else throw"error";if(n[1].success)k.value=n[1].data;else throw"error"}).catch(()=>{console.log("error")}).finally(()=>{C.value=!1})};p();const x=(t,e,r)=>{if(e!=0&&!e)return r(new Error("Please input value "));Number.isInteger(e)?e<=0?r(new Error("The number greater than 0")):r():r(new Error("Please input digits"))};return(t,e)=>{const r=s("el-text"),n=s("el-option"),w=s("el-select"),u=s("el-form-item"),h=s("el-input"),R=s("Plus"),F=s("el-icon"),O=s("el-form"),W=s("el-dialog");return m(),b(q,null,[P("div",null,[l(G,{loading:C.value,class:"table-page",columns:I,data:z.value,itemsTotalLength:E.value,onPaginationChange:K},{default:i(()=>[P("div",te,[l(A,{items:V,onChange:e[0]||(e[0]=o=>p())},null,8,["items"])]),P("div",ae,[l(N(D),{class:"create-new-button",type:"primary",onClick:B},{default:i(()=>[_("Create New Product")]),_:1})])]),_:1},8,["loading","columns","data","itemsTotalLength"])]),l(W,{class:"information-dialog",width:"450px",modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=o=>g.value=o)},{header:i(()=>[l(r,null,{default:i(()=>[_("Create New Product")]),_:1})]),footer:i(()=>[l(N(D),{type:"primary",onClick:T},{default:i(()=>[_("Create")]),_:1}),l(N(D),{onClick:e[6]||(e[6]=o=>g.value=!1)},{default:i(()=>[_(" Cancel ")]),_:1})]),default:i(()=>[l(O,{model:a,"label-width":"120px",class:"form-container","label-position":"left"},{default:i(()=>[l(u,{prop:"category_id",style:{width:"250px"},label:"Category",rules:[{required:!0,message:"Please choose your product",trigger:"blur"}]},{default:i(()=>[l(w,{modelValue:a.category_id,"onUpdate:modelValue":e[1]||(e[1]=o=>a.category_id=o),filterable:"",placeholder:"Select"},{default:i(()=>[(m(!0),b(q,null,S(k.value,o=>(m(),j(n,{key:o.category_id,label:o.category_name,value:o.category_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{prop:"product_name",label:"Name",rules:[{required:!0,message:"Please input product name",trigger:"blur"}]},{default:i(()=>[l(h,{modelValue:a.product_name,"onUpdate:modelValue":e[2]||(e[2]=o=>a.product_name=o)},null,8,["modelValue"])]),_:1}),l(u,{prop:"quantity",label:"Stock",rules:[{required:!0,trigger:"blur",validator:x}]},{default:i(()=>[l(h,{modelValue:a.quantity,"onUpdate:modelValue":e[3]||(e[3]=o=>a.quantity=o),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["rules"]),l(u,{prop:"price",label:"Price",rules:[{required:!0,trigger:"blur",validator:x}]},{default:i(()=>[l(h,{modelValue:a.price,"onUpdate:modelValue":e[4]||(e[4]=o=>a.price=o),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["rules"]),l(u,{prop:"original_price",label:"Original Price",rules:[{required:!0,trigger:"blur",validator:x}]},{default:i(()=>[l(h,{modelValue:a.original_price,"onUpdate:modelValue":e[5]||(e[5]=o=>a.original_price=o),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["rules"]),l(u,{prop:"images",label:"Images",rules:[{required:!0,message:"Please select product icon",trigger:"blur"}]},{default:i(()=>[P("div",{class:"icon-upload",onClick:U},[l(F,{size:"30",color:"#fff"},{default:i(()=>[l(R)]),_:1})]),(m(!0),b(q,null,S(f.value,(o,M)=>(m(),b("img",{key:M,src:o,alt:"",class:"icon-shown"},null,8,le))),128))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const ce=H(re,[["__scopeId","data-v-700e0aa2"]]);export{ce as default};
